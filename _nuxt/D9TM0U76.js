import{_ as G}from"./CjDoilxn.js";import{u as H}from"./CSRmsPlC.js";import{u as O,a as U}from"./CQAXTdqx.js";import{_ as P,m as J,z as Q,r as u,e as V,A as S,v as W,B as X,C as Z,c as o,o as c,k as K,a as t,h as ee,d as te,p as T,F as I,i as D,b as F,y as ae,x as se,l as ie,t as _,j as le,w as ne}from"./CmTyiSrX.js";import{c as re}from"./C90nouMY.js";import{c as v}from"./BcsVgARc.js";const ce={class:"tech-archive-section"},oe={class:"tech-archive-container"},ue={class:"tech-archive-header"},de={class:"tech-year-selector"},ve=["onClick"],he={class:"tech-archive-grid"},_e={class:"tech-timeline-header"},fe={class:"tech-timeline-marker"},pe={class:"tech-timeline-date"},me={class:"tech-articles-container"},ye={class:"tech-article-content"},ge={class:"tech-article-title"},ke={class:"tech-article-date"},be={class:"tech-article-arrow"},we={key:1,class:"tech-article-invalid"},xe={class:"tech-article-content"},$e={class:"tech-article-title"},Ce={class:"tech-article-date"},Me={key:0,class:"tech-loading-container"},Ie={class:"tech-loading-spinner"},De={__name:"index",async setup(Fe){let h,m;const y=J(),q=Q(),n=u(null),g=u({}),A=u([]),k=u(!1),b=u(!0),w=u(0),z=re.articleListMaxLimit,M=u(null);let f=null;y.query.year&&!isNaN(y.query.year)&&(n.value=parseInt(y.query.year));const{data:B}=([h,m]=V(async()=>O("available-years",async()=>{try{return await U().getAvailableYears()}catch(a){return console.error("Failed to fetch available years:",a),[]}})),h=await h,m(),h);B.value&&(A.value=B.value);const E=(a,e)=>{const s={...a};return Object.keys(e).forEach(l=>{if(s[l]){const p=new Set(s[l].map(d=>d.id)),i=e[l].filter(d=>!p.has(d.id));s[l]=[...s[l],...i]}else s[l]=e[l]}),s},x=async(a=null,e=0,s=!1)=>{try{const l=U(),p=n.value===null?z:null,i=await l.getArticlesGroupByYearMonth(a,p,e);return s?g.value=E(g.value,i.posts):g.value=i.posts,b.value=i.hasMore,w.value=e+(i.limit||0),i}catch(l){if(s)return console.error("Failed to load more articles:",l),{posts:{},hasMore:!1};throw se({message:l.message||"Failed to fetch articles"})}},L=async()=>{if(!(k.value||!b.value||n.value!==null)){k.value=!0;try{await x(null,w.value,!0)}finally{k.value=!1}}},j=()=>{!M.value||typeof IntersectionObserver>"u"||(f=new IntersectionObserver(a=>{const[e]=a;e.isIntersecting&&n.value===null&&L()},{rootMargin:"100px"}),f.observe(M.value))},R=()=>{f&&(f.disconnect(),f=null)};[h,m]=V(()=>O(`archives-${n.value||"all"}`,()=>x(n.value,0,!1))),await h,m();const N=async a=>{n.value=a,w.value=0,b.value=!0,a?await q.push({query:{year:a}}):await q.push({query:{}});try{await x(a,0,!1)}catch(e){console.error("Failed to fetch posts for year:",a,e)}};S(()=>y.query.year,a=>{const e=a?parseInt(a):null;e!==n.value&&(n.value=e,w.value=0,b.value=!0,x(e,0,!1).catch(s=>{console.error("Failed to fetch posts for year:",e,s)}))});const $=u(`所有文章列表 - ${v.title}`),C=u("依據文章建立的時間，列出所有的文章連結，排列方式是利用文章建立的時間排序，由新到舊");return S(n,a=>{a?($.value=`${a} 年文章列表 - ${v.title}`,C.value=`${a} 年的所有文章，依據建立時間排序，由新到舊`):($.value=`所有文章列表 - ${v.title}`,C.value="依據文章建立的時間，列出所有的文章連結，排列方式是利用文章建立的時間排序，由新到舊")}),W(async()=>{await X(),j()}),Z(()=>{R()}),H({title:$,meta:[{name:"description",content:C},{property:"og:title",content:$},{property:"og:description",content:C},{property:"og:url",content:`${v.domain}${v.baseUrl}archives`}],link:[{rel:"canonical",href:`${v.domain}${v.baseUrl}archives`}]}),(a,e)=>{const s=ae("font-awesome-icon"),l=G,p=ie("motion");return c(),o("section",ce,[K((c(),o("motion-div",oe,[t("div",ue,[e[1]||(e[1]=t("h1",{class:"tech-archive-title"},[t("span",{class:"tech-accent"},"文章"),te(" 列表 ")],-1)),e[2]||(e[2]=t("div",{class:"tech-divider"},null,-1)),e[3]||(e[3]=t("p",{class:"tech-archive-subtitle"}," 依據建立時間排序的所有文章，探索知識的時光軌跡 ",-1)),t("div",de,[t("button",{class:T(["tech-year-btn",{active:n.value===null}]),onClick:e[0]||(e[0]=i=>N(null))}," 全部年份 ",2),(c(!0),o(I,null,D(A.value,i=>(c(),o("button",{key:i,class:T(["tech-year-btn",{active:n.value===i}]),onClick:d=>N(i)},_(i),11,ve))),128))])]),t("div",he,[(c(!0),o(I,null,D(g.value,(i,d)=>(c(),o("div",{key:d,class:"tech-timeline-group"},[t("div",_e,[t("div",fe,[F(s,{icon:["fas","calendar-alt"],class:"tech-timeline-icon"})]),t("h3",pe,_(d),1),e[4]||(e[4]=t("div",{class:"tech-timeline-line"},null,-1))]),t("div",me,[(c(!0),o(I,null,D(i,(r,Y)=>(c(),o("div",{key:`post_${Y}`,class:"tech-article-card"},[r&&r.id&&typeof r.id=="string"?(c(),le(l,{key:0,to:"/article/"+r.id,title:r.title,class:"tech-article-link"},{default:ne(()=>[t("div",ye,[t("h4",ge,_(r.title),1),t("span",ke,_(r.createDate),1)]),t("div",be,[F(s,{icon:["fas","arrow-right"]})])]),_:2},1032,["to","title"])):(c(),o("div",we,[t("div",xe,[t("h4",$e,_((r==null?void 0:r.title)||"Untitled"),1),t("span",Ce,_((r==null?void 0:r.createDate)||"Unknown date"),1)])]))]))),128))])]))),128))]),k.value&&n.value===null?(c(),o("div",Me,[t("div",Ie,[F(s,{icon:["fas","spinner"],spin:""})]),e[5]||(e[5]=t("p",{class:"tech-loading-text"}," 載入更多文章中... ",-1))])):ee("",!0),t("div",{ref_key:"loadMoreTrigger",ref:M,class:"tech-load-trigger"},null,512)])),[[p,{initial:{opacity:0,x:40},enter:{opacity:1,x:0,transition:{duration:.6}}}]])])}}},Ve=P(De,[["__scopeId","data-v-d8aeca42"]]);export{Ve as default};
